<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Three.js - Rotating 3D Logo</title>
    <link rel="stylesheet" href="style.css" />
  </head>
  <body>
    <div id="info">
      <a href="https://threejs.org" target="_blank" rel="noopener">three.js</a> - Rotating 3D Logo
    </div>

    <!-- Подключаем библиотеку Three.js через CDN -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/examples/js/controls/OrbitControls.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/examples/js/loaders/UltraHDRLoader.js"></script>

    <script>
      // Основной код для создания сцены и анимации

      // Параметры сцены
      const params = {
        autoRotate: true,
        metalness: 1.0,
        roughness: 0.0,
        exposure: 1.0,
        resolution: '2k',
        type: 'HalfFloatType',
      };

      let renderer, scene, camera, controls, torusMesh, loader;

      init();

      function init() {
        // Настроим рендерер
        renderer = new THREE.WebGLRenderer({ antialias: true });
        renderer.setPixelRatio(window.devicePixelRatio);
        renderer.setSize(window.innerWidth, window.innerHeight);
        document.body.appendChild(renderer.domElement);

        renderer.toneMapping = THREE.ACESFilmicToneMapping;
        renderer.toneMappingExposure = params.exposure;

        renderer.setAnimationLoop(render);

        // Создадим сцену
        scene = new THREE.Scene();

        // Создадим тор
        torusMesh = new THREE.Mesh(
          new THREE.TorusKnotGeometry(1, 0.4, 128, 128, 1, 3),
          new THREE.MeshStandardMaterial({
            roughness: params.roughness,
            metalness: params.metalness,
          })
        );
        scene.add(torusMesh);

        // Камера
        camera = new THREE.PerspectiveCamera(50, window.innerWidth / window.innerHeight, 1, 500);
        camera.position.set(0.0, 0.0, -6.0);

        // Управление камерой с помощью OrbitControls
        controls = new THREE.OrbitControls(camera, renderer.domElement);

        // Загрузим HDR-текстуру
        loader = new THREE.UltraHDRLoader();
        loader.setDataType(THREE.FloatType);

        const loadEnvironment = function (resolution = '2k', type = 'HalfFloatType') {
          loader.setDataType(THREE[type]);
          loader.load(`textures/equirectangular/spruit_sunrise_${resolution}.hdr.jpg`, function (texture) {
            texture.mapping = THREE.EquirectangularReflectionMapping;
            texture.needsUpdate = true;

            scene.background = texture;
            scene.environment = texture;
          });
        };

        loadEnvironment(params.resolution, params.type);

        // Добавим UI для управления параметрами
        const gui = new dat.GUI();
        gui.add(params, 'autoRotate');
        gui.add(params, 'metalness', 0, 1, 0.01);
        gui.add(params, 'roughness', 0, 1, 0.01);
        gui.add(params, 'exposure', 0, 4, 0.01);
        gui.add(params, 'resolution', ['2k', '4k']).onChange(function (value) {
          loadEnvironment(value, params.type);
        });
        gui.add(params, 'type', ['HalfFloatType', 'FloatType']).onChange(function (value) {
          loadEnvironment(params.resolution, value);
        });

        gui.open();

        window.addEventListener('resize', onWindowResize);
      }

      // Обработчик изменения размера окна
      function onWindowResize() {
        camera.aspect = window.innerWidth / window.innerHeight;
        camera.updateProjectionMatrix();
        renderer.setSize(window.innerWidth, window.innerHeight);
      }

      // Основная функция рендеринга
      function render() {
        torusMesh.material.roughness = params.roughness;
        torusMesh.material.metalness = params.metalness;

        if (params.autoRotate) {
          torusMesh.rotation.y += 0.005;
        }

        renderer.toneMappingExposure = params.exposure;
        controls.update();
        renderer.render(scene, camera);
      }
    </script>
  </body>
</html>
